<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é™„é­”ä¹¦ç®¡ç†åå° - Glass UI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: 1px solid rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            --backdrop: blur(12px);
            --text-color: #fff;
            --accent-color: #3eaf7c;
            --danger-color: #f56c6c;
        }

        * { box-sizing: border-box; transition: all 0.3s ease; }
        body {
            margin: 0;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #1e1e2f 0%, #2d2d44 50%, #1a1a2e 100%);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 4px; }

        /* é€šç”¨ç»ç’ƒç±» */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: var(--backdrop);
            -webkit-backdrop-filter: var(--backdrop);
            border: var(--glass-border);
            box-shadow: var(--glass-shadow);
            border-radius: 16px;
        }

        /* ================= ç™»å½•é¡µ ================= */
        #login-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            z-index: 1000;
            background: inherit;
        }
        .login-box {
            width: 400px;
            padding: 40px;
            text-align: center;
        }
        .login-title { font-size: 1.8rem; margin-bottom: 30px; font-weight: 300; letter-spacing: 2px; }
        
        input[type="password"], input[type="text"], textarea, select {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
        }
        input:focus, textarea:focus { outline: none; border-color: var(--accent-color); background: rgba(0,0,0,0.5); }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary { background: var(--accent-color); color: white; box-shadow: 0 4px 15px rgba(62, 175, 124, 0.3); }
        .btn-danger { background: var(--danger-color); color: white; box-shadow: 0 4px 15px rgba(245, 108, 108, 0.3); }
        .btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .btn:active { transform: translateY(0); }

        /* ================= åå°ä¸»å¸ƒå±€ ================= */
        #dashboard-container {
            display: none; /* åˆå§‹éšè— */
            width: 100%; height: 100%;
            display: flex;
        }

        /* å·¦ä¾§å¯¼èˆª */
        .sidebar {
            width: 260px;
            height: 100%;
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 10;
        }
        .nav-item {
            padding: 15px 20px;
            cursor: pointer;
            border-radius: 12px;
            color: rgba(255,255,255,0.7);
            font-size: 1.1rem;
            display: flex; align-items: center; gap: 15px;
        }
        .nav-item:hover { background: rgba(255,255,255,0.05); color: #fff; }
        .nav-item.active { background: var(--accent-color); color: #fff; box-shadow: 0 5px 15px rgba(62, 175, 124, 0.4); }
        .logo-area { margin-bottom: 40px; font-size: 1.5rem; font-weight: bold; text-align: center; color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.5); }

        /* å³ä¾§å†…å®¹ */
        .main-content {
            flex: 1;
            position: relative;
            padding: 30px;
            overflow-y: auto;
        }

        /* é¡¶éƒ¨æ  */
        .header-bar {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 30px;
        }
        .page-title { font-size: 2rem; font-weight: bold; }

        /* å†…å®¹åŒºåŸŸåˆ‡æ¢ */
        .content-section { display: none; animation: fadeIn 0.4s ease; }
        .content-section.active { display: block; }

        /* ================= åŠŸèƒ½åŒºæ ·å¼ ================= */
        
        /* 1. æ–°å¢é™„é­”ä¹¦è¡¨å• */
        .form-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 25px;
            max-width: 1000px;
        }
        .form-group { display: flex; flex-direction: column; gap: 8px; }
        .form-group.full { grid-column: span 2; }
        label { font-size: 0.9rem; color: rgba(255,255,255,0.6); }

        /* ç­‰çº§æŒ‰é’®ç»„ */
        .level-selector { display: flex; gap: 10px; }
        .level-btn {
            width: 40px; height: 40px; border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(0,0,0,0.2); color: #fff;
            cursor: pointer; display: flex; justify-content: center; align-items: center;
        }
        .level-btn.active { background: #e6a23c; border-color: #e6a23c; color: #000; font-weight: bold; box-shadow: 0 0 10px #e6a23c; }

        /* é¢œè‰²é€‰æ‹© */
        .quality-selector { display: flex; gap: 10px; margin-top: 5px; }
        .q-btn { padding: 5px 15px; border-radius: 20px; cursor: pointer; font-size: 0.8rem; border: 1px solid transparent; opacity: 0.6; }
        .q-btn.active { opacity: 1; border-color: #fff; transform: scale(1.1); }
        
        /* å¿«é€Ÿé€‰æ‹©æ ‡ç­¾ */
        .tags-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 5px; }
        .tag-choice {
            padding: 5px 10px; background: rgba(255,255,255,0.1); 
            border-radius: 4px; font-size: 0.85rem; cursor: pointer;
        }
        .tag-choice:hover { background: rgba(255,255,255,0.2); }

        /* 2. å¡ç‰‡å±•ç¤º (æ€»è§ˆ & åˆ é™¤) */
        .search-bar-container { margin-bottom: 20px; }
        .card-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px;
        }
        .book-card {
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        .book-card:hover { transform: translateY(-5px); border-color: rgba(255,255,255,0.3); }
        .book-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 5px; height: 100%;
        }
        /* é¢œè‰²æ¡ */
        .card-ç™½::before { background: #909399; }
        .card-ç»¿::before { background: #67c23a; }
        .card-è“::before { background: #409eff; }
        .card-ç´«::before { background: #a355d6; }
        .card-é‡‘::before { background: #e6a23c; }
        .card-çº¢::before { background: #f56c6c; }

        .card-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px; }
        .card-name { font-size: 1.2rem; font-weight: bold; margin: 0; }
        .card-level { font-size: 0.9rem; background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px; }
        .card-price { color: #e6a23c; font-weight: bold; font-size: 1.1rem; margin: 10px 0; }
        .card-desc { font-size: 0.85rem; color: rgba(255,255,255,0.6); height: 40px; overflow: hidden; }
        .delete-overlay {
            position: absolute; top: 10px; right: 10px;
        }

        /* æ¶ˆæ¯æç¤º */
        .toast {
            position: fixed; bottom: 30px; right: 30px;
            padding: 15px 30px; border-radius: 8px;
            color: #fff; z-index: 2000;
            transform: translateY(100px); opacity: 0;
        }
        .toast.active { transform: translateY(0); opacity: 1; }
        .toast.success { background: #67c23a; box-shadow: 0 5px 15px rgba(103, 194, 58, 0.4); }
        .toast.error { background: #f56c6c; box-shadow: 0 5px 15px rgba(245, 108, 108, 0.4); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <!-- 1. ç™»å½•å±‚ -->
    <div id="login-container">
        <div class="glass-panel login-box">
            <div class="login-title"><i class="fa-solid fa-book-journal-whills"></i> é™„é­”ä¹¦åå°</div>
            <input type="password" id="ghToken" placeholder="è¯·è¾“å…¥è®¿é—®æš—å· (SLXZ3238)">
            
            <!-- éšè—çš„é…ç½®å­—æ®µ -->
            <div style="display:none">
                <input type="text" id="ghOwner" value="C-4-C-4">
                <input type="text" id="ghRepo" value="Enchanted-Book">
                <input type="text" id="ghPath" value="data.json">
            </div>

            <button class="btn btn-primary" style="width:100%; justify-content:center" onclick="attemptLogin()">
                <i class="fa-solid fa-right-to-bracket"></i> è¿æ¥ç³»ç»Ÿ
            </button>
            <p id="loginMsg" style="font-size:0.8rem; color:rgba(255,255,255,0.5); margin-top:15px"></p>
        </div>
    </div>

    <!-- 2. ä¸»åå°å±‚ -->
    <div id="dashboard-container" style="display: none;">
        
        <!-- å·¦ä¾§å¯¼èˆª -->
        <div class="sidebar glass-panel" style="border-radius: 0 16px 16px 0; border-left: none;">
            <div class="logo-area">
                <i class="fa-solid fa-cube" style="color:var(--accent-color)"></i> ç®¡ç†æ§åˆ¶å°
            </div>
            <div class="nav-item active" onclick="switchTab('add')">
                <i class="fa-solid fa-plus-circle"></i> å¢åŠ é™„é­”ä¹¦
            </div>
            <div class="nav-item" onclick="switchTab('delete')">
                <i class="fa-solid fa-trash-can"></i> åˆ é™¤é™„é­”ä¹¦
            </div>
            <div class="nav-item" onclick="switchTab('list')">
                <i class="fa-solid fa-list"></i> é™„é­”ä¹¦æ€»è§ˆ
            </div>
            
            <div style="margin-top:auto; font-size:0.8rem; color:rgba(255,255,255,0.3); text-align:center;">
                v2.0 Glass Edition
            </div>
        </div>

        <!-- å³ä¾§å†…å®¹ -->
        <div class="main-content">
            <div class="header-bar">
                <div class="page-title" id="pageTitle">å¢åŠ é™„é­”ä¹¦</div>
                <button class="btn btn-primary" onclick="pushToGitHub()">
                    <i class="fa-solid fa-cloud-upload"></i> å‘å¸ƒæ›´æ–°åˆ° GitHub
                </button>
            </div>

            <!-- åŠŸèƒ½ 1: å¢åŠ é™„é­”ä¹¦ -->
            <div id="view-add" class="content-section active">
                <div class="glass-panel" style="padding: 30px;">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>é™„é­”ä¹¦åç§°</label>
                            <input type="text" id="inputName" placeholder="ä¾‹å¦‚: é”‹åˆ©">
                        </div>
                        <div class="form-group">
                            <label>ä»·æ ¼ (é‡‘å¸)</label>
                            <input type="number" id="inputPrice" placeholder="ä¾‹å¦‚: 64">
                        </div>
                        
                        <div class="form-group full">
                            <label>ç­‰çº§é€‰æ‹©</label>
                            <div class="level-selector" id="levelContainer">
                                <!-- JS ç”ŸæˆæŒ‰é’® -->
                            </div>
                            <input type="hidden" id="inputLevel" value="ä¸€çº§">
                        </div>

                        <div class="form-group full">
                            <label>å“è´¨ (å†³å®šèƒŒæ™¯é¢œè‰²)</label>
                            <div class="quality-selector">
                                <div class="q-btn" style="background:#909399" onclick="selectColor('ç™½', this)">ç™½ (æ™®é€š)</div>
                                <div class="q-btn" style="background:#67c23a" onclick="selectColor('ç»¿', this)">ç»¿ (ä¼˜ç§€)</div>
                                <div class="q-btn" style="background:#409eff" onclick="selectColor('è“', this)">è“ (ç¨€æœ‰)</div>
                                <div class="q-btn" style="background:#a355d6" onclick="selectColor('ç´«', this)">ç´« (å²è¯—)</div>
                                <div class="q-btn" style="background:#e6a23c" onclick="selectColor('é‡‘', this)">é‡‘ (ä¼ è¯´)</div>
                                <div class="q-btn" style="background:#f56c6c" onclick="selectColor('çº¢', this)">çº¢ (ç¥è¯)</div>
                            </div>
                            <input type="hidden" id="inputColor" value="ç™½">
                        </div>

                        <div class="form-group full">
                            <label>å†²çªé™„é­” (æ‰‹åŠ¨è¾“å…¥æˆ–ç‚¹å‡»æ·»åŠ )</label>
                            <input type="text" id="inputConflicts" placeholder="æ‰‹åŠ¨è¾“å…¥ï¼Œç”¨é€—å·åˆ†éš”">
                            <div class="tags-container">
                                <span class="tag-choice" onclick="addText('inputConflicts', 'é”‹åˆ©')">é”‹åˆ©</span>
                                <span class="tag-choice" onclick="addText('inputConflicts', 'äº¡çµæ€æ‰‹')">äº¡çµæ€æ‰‹</span>
                                <span class="tag-choice" onclick="addText('inputConflicts', 'èŠ‚è‚¢æ€æ‰‹')">èŠ‚è‚¢æ€æ‰‹</span>
                                <span class="tag-choice" onclick="addText('inputConflicts', 'ä¿æŠ¤')">ä¿æŠ¤</span>
                                <span class="tag-choice" onclick="addText('inputConflicts', 'ç«ç„°ä¿æŠ¤')">ç«ç„°ä¿æŠ¤</span>
                                <span class="tag-choice" onclick="addText('inputConflicts', 'ç»éªŒä¿®è¡¥')">ç»éªŒä¿®è¡¥</span>
                            </div>
                        </div>

                        <div class="form-group full">
                            <label>é€‚ç”¨ç‰©å“ (æ‰‹åŠ¨è¾“å…¥æˆ–ç‚¹å‡»æ·»åŠ )</label>
                            <div class="tags-container" style="margin-bottom:10px">
                                <span class="tag-choice" onclick="addText('inputTarget', 'å‰‘')"><i class="fa-solid fa-khanda"></i> å‰‘</span>
                                <span class="tag-choice" onclick="addText('inputTarget', 'æ–§')"><i class="fa-solid fa-hammer"></i> æ–§</span>
                                <span class="tag-choice" onclick="addText('inputTarget', 'å¼“')"><i class="fa-solid fa-bow-arrow"></i> å¼“</span>
                                <span class="tag-choice" onclick="addText('inputTarget', 'ç›”ç”²')"><i class="fa-solid fa-shirt"></i> ç›”ç”²</span>
                                <span class="tag-choice" onclick="addText('inputTarget', 'å·¥å…·')"><i class="fa-solid fa-screwdriver-wrench"></i> å·¥å…·</span>
                                <span class="tag-choice" onclick="addText('inputTarget', 'å…¨ç‰©å“')"><i class="fa-solid fa-star"></i> å…¨ç‰©å“</span>
                            </div>
                            <input type="text" id="inputTarget" placeholder="ä¾‹å¦‚: å‰‘, æ–§">
                        </div>

                        <div class="form-group full">
                            <label>æè¿°ä¿¡æ¯</label>
                            <textarea id="inputDesc" rows="3" placeholder="ç®€çŸ­æè¿°é™„é­”ä¹¦çš„æ•ˆæœ..."></textarea>
                        </div>

                        <div class="form-group full" style="margin-top:10px">
                            <button class="btn btn-primary" style="width:100%; justify-content:center" onclick="saveItem()">
                                <i class="fa-solid fa-floppy-disk"></i> ä¿å­˜åˆ°æš‚å­˜åŒº
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- åŠŸèƒ½ 2: åˆ é™¤é™„é­”ä¹¦ -->
            <div id="view-delete" class="content-section">
                <div class="glass-panel search-bar-container" style="padding:15px;">
                    <i class="fa-solid fa-search" style="margin-left:10px; color:rgba(255,255,255,0.5)"></i>
                    <input type="text" id="searchDelete" placeholder="è¾“å…¥åç§°æœç´¢è¦åˆ é™¤çš„é™„é­”ä¹¦..." oninput="renderCards('delete')" 
                           style="border:none; background:transparent; margin:0; padding-left:10px; width:90%;">
                </div>
                <div id="deleteCardGrid" class="card-grid"></div>
            </div>

            <!-- åŠŸèƒ½ 3: æ€»è§ˆ -->
            <div id="view-list" class="content-section">
                <div class="glass-panel search-bar-container" style="padding:15px;">
                    <i class="fa-solid fa-filter" style="margin-left:10px; color:rgba(255,255,255,0.5)"></i>
                    <input type="text" id="searchList" placeholder="ç­›é€‰é™„é­”ä¹¦..." oninput="renderCards('list')" 
                           style="border:none; background:transparent; margin:0; padding-left:10px; width:90%;">
                </div>
                <div id="listCardGrid" class="card-grid"></div>
            </div>

        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        // ================== é…ç½® ==================
        const SHORT_CODE = "SLXZ3238"; 
        const PART_1 = ""; // è¯·åœ¨å¼•å·å†…å¡«å…¥Tokenå‰åŠéƒ¨åˆ†
        const PART_2 = ""; // è¯·åœ¨å¼•å·å†…å¡«å…¥TokenååŠéƒ¨åˆ†
        const REAL_TOKEN = PART_1 + PART_2;

        let items = [];
        let sha = ''; 
        const levelMap = ["ä¸€çº§", "äºŒçº§", "ä¸‰çº§", "å››çº§", "äº”çº§", "å…­çº§", "ä¸ƒçº§"];

        // ================== åˆå§‹åŒ– & ç™»å½• ==================
        window.onload = () => {
            initLevelButtons();
            const savedPass = localStorage.getItem('admin_pass');
            if (savedPass) {
                document.getElementById('ghToken').value = savedPass;
                attemptLogin(); // å°è¯•è‡ªåŠ¨ç™»å½•
            }
        };

        function getAuthToken() {
            const input = document.getElementById('ghToken').value;
            if (input === SHORT_CODE) {
                if (REAL_TOKEN === "") {
                    alert("ä»£ç ä¸­æœªé…ç½®çœŸå®Tokenï¼");
                    return "";
                }
                return REAL_TOKEN;
            }
            return input;
        }

        async function attemptLogin() {
            const token = getAuthToken();
            if (!token) {
                showToast("è¯·è¾“å…¥å¯†ç ", "error");
                return;
            }

            const owner = document.getElementById('ghOwner').value;
            const repo = document.getElementById('ghRepo').value;
            const path = document.getElementById('ghPath').value;
            const msgSpan = document.getElementById('loginMsg');

            msgSpan.innerText = "æ­£åœ¨è¿æ¥ GitHub...";
            
            const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
            
            try {
                const res = await fetch(url, {
                    headers: { 'Authorization': `token ${token}`, 'Accept': 'application/vnd.github.v3+json' }
                });
                
                if (!res.ok) {
                    if (res.status === 401) throw new Error("å¯†ç æ— æ•ˆ");
                    throw new Error("è¿æ¥å¤±è´¥: " + res.status);
                }

                const data = await res.json();
                sha = data.sha;
                const content = decodeURIComponent(escape(window.atob(data.content)));
                items = JSON.parse(content);

                // ç™»å½•æˆåŠŸ
                localStorage.setItem('admin_pass', document.getElementById('ghToken').value);
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('dashboard-container').style.display = 'flex';
                
                // é»˜è®¤åŠ è½½æ€»è§ˆ
                switchTab('add');
                showToast(`æˆåŠŸåŠ è½½ ${items.length} ä¸ªæ•°æ®`, "success");

            } catch (e) {
                msgSpan.innerText = "âŒ " + e.message;
                if(e.message.includes('404')) {
                    // å…è®¸ 404 (é¦–æ¬¡ä½¿ç”¨)
                    items = [];
                    document.getElementById('login-container').style.display = 'none';
                    document.getElementById('dashboard-container').style.display = 'flex';
                    showToast("æ–°ä»“åº“ï¼Œæ•°æ®åˆå§‹åŒ–ä¸ºç©º", "success");
                }
            }
        }

        // ================== é¡µé¢é€»è¾‘ ==================

        // åˆ‡æ¢å·¦ä¾§å¯¼èˆª
        function switchTab(tabName) {
            // æ›´æ–°å¯¼èˆªæ ·å¼
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            event.currentTarget ? event.currentTarget.classList.add('active') : document.querySelector(`.nav-item:first-child`).classList.add('active');
            
            // æ›´æ–°å†…å®¹åŒº
            document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
            document.getElementById(`view-${tabName}`).classList.add('active');

            // æ ‡é¢˜æ›´æ–°ä¸æ•°æ®åˆ·æ–°
            if(tabName === 'add') {
                document.getElementById('pageTitle').innerText = 'å¢åŠ é™„é­”ä¹¦';
            } else if(tabName === 'delete') {
                document.getElementById('pageTitle').innerText = 'åˆ é™¤é™„é­”ä¹¦';
                renderCards('delete');
            } else {
                document.getElementById('pageTitle').innerText = 'é™„é­”ä¹¦æ€»è§ˆ';
                renderCards('list');
            }
        }

        // ç”Ÿæˆç­‰çº§æŒ‰é’®
        function initLevelButtons() {
            const container = document.getElementById('levelContainer');
            levelMap.forEach((lvl, idx) => {
                const btn = document.createElement('div');
                btn.className = 'level-btn' + (idx === 0 ? ' active' : '');
                btn.innerText = idx + 1;
                btn.onclick = () => {
                    document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    document.getElementById('inputLevel').value = lvl;
                };
                container.appendChild(btn);
            });
        }

        // é€‰æ‹©é¢œè‰²
        function selectColor(color, el) {
            document.getElementById('inputColor').value = color;
            document.querySelectorAll('.q-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        // å¿«æ·æ·»åŠ æ–‡æœ¬
        function addText(inputId, text) {
            const input = document.getElementById(inputId);
            let current = input.value;
            if(current.length > 0 && !current.trim().endsWith(',')) {
                current += ', ';
            }
            input.value = current + text;
        }

        // ä¿å­˜æ–°å¢
        function saveItem() {
            const name = document.getElementById('inputName').value;
            if(!name) return showToast('è¯·è¾“å…¥åç§°', 'error');

            const newItem = {
                id: name, // ç®€å•ç”¨åå­—åšID
                name_zh: name,
                level_zh: document.getElementById('inputLevel').value,
                price: document.getElementById('inputPrice').value || 0,
                desc_zh: document.getElementById('inputDesc').value || 'æ— æè¿°',
                color: document.getElementById('inputColor').value,
                target_zh: document.getElementById('inputTarget').value || 'é€šç”¨',
                conflicts_zh: document.getElementById('inputConflicts').value || 'æ— å†²çª'
            };

            items.push(newItem);
            showToast('âœ… å·²ä¿å­˜ï¼Œè¯·è®°å¾—ç‚¹å‡»å³ä¸Šè§’å‘å¸ƒ', 'success');
            
            // æ¸…ç©ºè¾“å…¥ (å¯é€‰)
            document.getElementById('inputName').value = '';
            document.getElementById('inputDesc').value = '';
        }

        // æ¸²æŸ“å¡ç‰‡ (ç”¨äºåˆ é™¤é¡µå’Œæ€»è§ˆé¡µ)
        function renderCards(mode) {
            const gridId = mode === 'delete' ? 'deleteCardGrid' : 'listCardGrid';
            const searchId = mode === 'delete' ? 'searchDelete' : 'searchList';
            const filter = document.getElementById(searchId).value.toLowerCase();
            const container = document.getElementById(gridId);
            
            container.innerHTML = '';

            items.forEach((item, index) => {
                if(filter && !item.name_zh.toLowerCase().includes(filter)) return;

                const card = document.createElement('div');
                card.className = `book-card card-${item.color}`;
                
                let btnHtml = '';
                if(mode === 'delete') {
                    btnHtml = `<button class="btn btn-danger" style="padding:5px 10px; font-size:0.8rem" onclick="deleteItem(${index})"><i class="fa-solid fa-trash"></i> åˆ é™¤</button>`;
                }

                card.innerHTML = `
                    <div class="card-header">
                        <h3 class="card-name">${item.name_zh}</h3>
                        ${btnHtml}
                    </div>
                    <span class="card-level">${item.level_zh}</span>
                    <div class="card-price">ğŸª™ ${item.price}</div>
                    <div class="card-desc">${item.desc_zh}</div>
                    <div style="margin-top:10px; font-size:0.8rem; color:rgba(255,255,255,0.5)">
                        é€‚ç”¨: ${item.target_zh}
                    </div>
                `;
                container.appendChild(card);
            });

            if(items.length === 0) container.innerHTML = '<div style="color:rgba(255,255,255,0.5)">æš‚æ— æ•°æ®</div>';
        }

        // åˆ é™¤æ¡ç›®
        function deleteItem(index) {
            if(confirm('ç¡®å®šåˆ é™¤è¯¥é™„é­”ä¹¦ï¼Ÿ')) {
                items.splice(index, 1);
                renderCards('delete');
                showToast('å·²åˆ é™¤', 'success');
            }
        }

        // å‘å¸ƒåˆ° GitHub
        async function pushToGitHub() {
            const token = getAuthToken();
            if (!token) return;
            
            const owner = document.getElementById('ghOwner').value;
            const repo = document.getElementById('ghRepo').value;
            const path = document.getElementById('ghPath').value;

            // UTF-8 Base64 ç¼–ç 
            const contentStr = JSON.stringify(items, null, 4);
            const contentBase64 = window.btoa(unescape(encodeURIComponent(contentStr)));

            const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
            const body = {
                message: "Update via Glass Admin",
                content: contentBase64,
                sha: sha
            };

            try {
                showToast('ğŸš€ æ­£åœ¨ä¸Šä¼ åˆ° GitHub...', 'success');
                const res = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });

                if (!res.ok) throw new Error(await res.text());

                const data = await res.json();
                sha = data.content.sha;
                showToast('âœ… å‘å¸ƒæˆåŠŸï¼', 'success');
            } catch (e) {
                showToast('âŒ å‘å¸ƒå¤±è´¥: ' + e.message, 'error');
            }
        }

        function showToast(msg, type) {
            const t = document.getElementById('toast');
            t.innerHTML = msg;
            t.className = `toast ${type} active`;
            setTimeout(() => {
                t.classList.remove('active');
            }, 3000);
        }
    </script>
</body>
</html>